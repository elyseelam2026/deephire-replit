# DeepHire - AI-Powered Talent Acquisition Platform

## Overview
DeepHire is an enterprise-grade B2B recruiting platform that uses AI to transform talent acquisition. It functions as an AI-powered executive search consultant, learning hiring patterns, understanding career trajectories, and semantically matching candidates. The platform provides intelligent candidate matching, automated job description parsing, and streamlined recruitment workflows for recruiting firms, their clients, and candidates. It features a multi-portal architecture, AI-driven candidate longlisting, and comprehensive management systems for candidates and jobs, emphasizing enterprise design, professional aesthetics, and data-heavy interfaces.

The long-term vision focuses on a bottom-up intelligence system:
1.  **Company Intelligence**: AI extracts and categorizes data from 1000+ company websites (industry, stage, funding, geography, size).
2.  **Organization Chart Mapping**: Gradually builds org charts by discovering team members.
3.  **Pattern Learning**: Analyzes org charts to identify hiring patterns.
4.  **Semantic Matching**: Matches candidates based on learned patterns and career path similarity.
5.  **Culture Insights**: Learns company culture through recruiter/candidate interactions.

## User Preferences
Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend
-   **Framework**: React 18 with TypeScript.
-   **UI/Styling**: Radix UI primitives, shadcn/ui components, Tailwind CSS with a custom enterprise design system.
-   **State Management**: TanStack Query for server state.
-   **Routing**: Wouter.
-   **Theme**: Dark/light mode.

### Backend
-   **Runtime**: Node.js with Express.js.
-   **Language**: TypeScript.
-   **AI Integration**: xAI's Grok model for job description parsing and candidate matching.
-   **Session Management**: Express sessions with PostgreSQL store.

### Database
-   **Primary Database**: PostgreSQL with Neon serverless hosting.
-   **ORM**: Drizzle ORM for type-safe operations.
-   **Schema**: Comprehensive models for Companies, Candidates, Jobs, Job matches, Users, Data ingestion jobs, and Duplicate detection, with multi-language name support.
-   **Company Role Architecture**: Companies can have roles like `['client', 'sourcing', 'prospecting']`.
-   **Duplicate Detection**: Prioritizes website domain matching (40% weight) to prevent duplicates.
-   **Custom Fields System**: Flexible architecture for candidate data using `custom_field_sections`, `custom_field_definitions`, and JSONB storage for values.
-   **Soft Delete**: Candidates are soft-deleted using a `deleted_at` timestamp.

### AI and Machine Learning - Multi-Platform Architecture
-   **Hybrid AI Strategy**: Best-of-breed approach using specialized AI services for different capabilities.
-   **xAI Grok-2-1212** (Conversational Intelligence):
    -   131k token context window for complex reasoning
    -   Job description parsing and requirement extraction
    -   Intelligent candidate longlist generation with scoring
    -   AI biography generation and career history analysis
    -   Team discovery and office location extraction
    -   Multi-turn conversational interface for clarifying requirements
-   **Voyage AI** (Semantic Search & Embeddings):
    -   voyage-2 model for general-purpose semantic embeddings (1024 dimensions)
    -   Document embeddings for candidate profiles (input_type="document")
    -   Query embeddings for search optimization (input_type="query")
    -   Enables true semantic matching beyond keyword search
    -   Accessible from Hong Kong (OpenAI alternative)
-   **PostgreSQL pgvector** (Vector Database):
    -   Native vector similarity search using cosine distance
    -   Efficient indexed lookups for large candidate databases
    -   1024-dimension vector columns for cv_embedding
-   **Company Intelligence Engine**: Auto-categorizes companies and lays the foundation for pattern learning.
-   **Embeddings Infrastructure**:
    -   API endpoints: POST `/api/embeddings/generate` (batch), POST `/api/embeddings/search` (query)
    -   Automatic embedding refresh (7-day staleness threshold)
    -   Storage.semanticSearchCandidates() for database-level vector search

### Design System
-   **Philosophy**: Enterprise-first, professional, and usable.
-   **Palette**: Deep navy primary, professional green accents.
-   **Typography**: Inter font family.
-   **Components**: Reusable components for data tables, cards, forms, navigation.

### Key Technical Implementations
-   **Conversational AI Recruiting Assistant** (MVP Feature): ChatGPT-style interface for investor demos where clients interact with AI to find candidates:
    -   **Grok-Powered Conversational AI**: All responses generated by xAI's Grok-2-1212 model, not hardcoded templates - enables natural, dynamic dialogue
    -   **Consultative AI Approach**: Grok asks clarifying questions BEFORE searching, working like a real executive recruiter instead of an order-taking chatbot
    -   **Context-Aware Intelligence**: Auto-loads user's company metadata (industry, size, stage) on conversation start; Grok only asks for missing information to avoid redundant questions
    -   **Dialogue-Based Interaction**: Grok detects greetings/casual messages vs hiring intent, responds conversationally to "Hi, how are you?" without forcing job questions
    -   **Progressive Engagement**: Stays casual until user mentions hiring needs, then transitions smoothly to business guided by Grok's conversational intelligence
    -   **Conversation Memory**: Full conversation history passed to Grok for context-aware multi-turn dialogue
    -   **Enhanced Job Parsing**: Extracts 13 fields (title, skills, location, years of experience, industry, company size, urgency, salary, department, requirements, responsibilities, benefits) with flexible yearsExperience parsing ("5+ years", "5-7 years")
    -   **Multi-Turn Context Accumulation**: AI remembers and merges requirements across conversation turns (skills accumulated via deduplicated union, not replaced)
    -   **Phase Tracking**: Conversation progresses through phases: initial → clarifying → ready_to_search → job_order_created
    -   **Dual Input Methods**: Accepts both JD file uploads (PDF/DOCX) and natural language text messages
    -   **Two-Tier Search Pricing**: AI explains options before searching (15-min internal database vs extended external search with premium pricing)
    -   **Company Context Pre-Population**: POST `/api/conversations` accepts userId/companyId to auto-populate searchContext with company metadata from database
    -   **Intelligent Candidate Matching**: Searches database using `generateCandidateLonglist` with accumulated context, returns enriched candidate cards with name, title, company, location, skills, and match scores
    -   **Conversation Schema**: `nap_conversations` table with JSONB for messages, searchContext, matchedCandidates, and jdFileInfo
    -   **API Endpoints**: POST `/api/conversations` (create with optional userId/companyId), GET `/api/conversations/:id` (fetch), POST `/api/conversations/:id/messages` (send message with optional file)
    -   **UI Components**: ChatInterface with message bubbles, file upload, auto-scroll, and candidate result cards; Dashboard manages conversation lifecycle
    -   **Data Flow**: Single storage update at end of message handler ensures React Query invalidation provides complete updated conversation to UI
    -   **Demo Testing**: Dashboard accepts `?companyId=X` URL parameter to simulate authenticated user from specific company
-   **Hybrid LinkedIn Search**: Two-stage search (exact then loose) for candidate finding.
-   **LinkedIn Profile Validation**: Multi-result scoring with confidence thresholds via SerpAPI.
-   **Boolean Search**: Advanced LinkedIn search for Quick Add.
-   **Enhanced Team Discovery**: Supports pagination, multi-language sites, and uses a 3-tier scraping system with Google Search fallback.
-   **Multi-Language Name System**: 3-step transliteration pipeline for international candidate names (ASCII detection, auto-transliteration, initials fallback) and email inference.
-   **Salesforce-Style Custom Fields**: Allows flexible, user-defined fields for candidate data with various field types and a complete REST API.
-   **Candidate Management**: Full CRUD operations for candidates with comprehensive editing, document management, and interaction tracking.
    -   **Edit Functionality**: PATCH `/api/candidates/:id` with field whitelisting for security
    -   **Document Upload**: Intelligent text extraction (PDF via pdf-parse, DOCX via mammoth, TXT direct)
    -   **Notes System**: JSONB `interactionHistory` field storing typed notes (note/call/email/meeting)
-   **Flexible Processing Modes**: Four modes for candidate uploads (`full`, `career_only`, `bio_only`, `data_only`) to optimize credit usage, with a retroactive processing feature for selective processing of uploaded candidates.
-   **Recycling Bin Feature**: Soft delete for candidates with restore functionality and a dedicated UI.
-   **Multi-Layer Office Extraction System**: 4-layer pipeline (JSON-LD, Microdata, CSS Selectors, AI) for reliable office location extraction, with retry logic and HTML parsing using Cheerio.

## External Dependencies

### AI Services
-   **xAI Grok API**: Conversational intelligence, job parsing, candidate matching logic.
-   **Voyage AI**: Semantic embeddings and vector search capabilities.

### Data Services
-   **SerpAPI**: For search engine results, LinkedIn profile discovery, and email pattern research.
-   **Bright Data**: For LinkedIn profile scraping.

### Database
-   **Neon PostgreSQL**: Serverless database hosting.
-   **Drizzle ORM**: Database interactions.

### Email Services
-   **SendGrid**: Transactional email delivery.